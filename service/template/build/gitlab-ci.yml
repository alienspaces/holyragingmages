
build-template:
  stage: build
  image: google/cloud-sdk
  services:
    - docker:19.03.5-dind
  script:
    - echo "$GCLOUD_SERVICE_ACCOUNT_KEY" > gcloud-service-key.json # Google Cloud service accounts
    - gcloud auth activate-service-account --key-file gcloud-service-key.json
    - gcloud config set project eng-braid-266903
    - gcloud container clusters get-credentials alienspaces-cluster-1 --zone australia-southeast1-a
    # - docker build -t $CI_REGISTRY_IMAGE:latest .
    # # push only for tags
    # - "[[ -z $CI_BUILD_TAG ]] && exit 0"
    # - docker tag $CI_REGISTRY_IMAGE:latest $CI_REGISTRY_IMAGE:$CI_BUILD_TAG
    # - docker login -u gitlab-ci-token -p $CI_BUILD_TOKEN $CI_REGISTRY
    # - docker push $CI_REGISTRY_IMAGE:$CI_BUILD_TAG
  tags:
    - docker
